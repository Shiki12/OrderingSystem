<!DOCTYPE html>
<html lang="en">
<head>
    <title>Menu</title>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link href="../../static/css/menu/bootstrap.css" rel="stylesheet" type="text/css" media="all" />
    <!--// bootstrap-css -->
    <!-- css -->
    <!--====== Bootstrap css ======-->
    <link rel="stylesheet" href="../../static/css/front-css/bootstrap.min.css">


    <!-- 我的样式   -->
    <link rel="stylesheet" href="../../static/css/front-css/addmy-index.css">
    <link rel="stylesheet" href="../../static/css/front-css/style.css">
    <link rel="stylesheet" href="../../static/css/front-css/addmymanu.css">

    <link rel="stylesheet" href="../../static/css/menu/style.css" type="text/css" media="all" />
    <link rel="stylesheet" href="../../static/css/menu/lightbox.css">
    <link rel="stylesheet" href="../../static/css/front-css/shopping.css">
    <!--// css -->
    <!-- font-awesome icons -->
    <link href="../../static/css/menu/font-awesome.css" rel="stylesheet">
    <!-- //font-awesome icons -->
    <!-- font -->

    <!--====== jquery js ======-->
    <script src="../../static/js/front-js/vendor/modernizr-3.6.0.min.js"></script>
    <script src="../../static/js/front-js/vendor/jquery-3.5.1.min.js"></script>

    <!--点击事件-->
    <script src="../../static/js/front-js/index.js"></script>
    <!--====== Main js ======-->
    <script src="../../static/js/front-js/cusmanu.js"></script>
    <script src="../../static/js/front-js/main.js"></script>
    <!-- light-box -->
    <link rel="stylesheet" href="../../static/css/menu/lightbox.css">
    <!-- //light-box -->
    <script src="../../static/js/front-js/SmoothScroll.min.js"></script>
    <!--search jQuery-->
    <script src="../../static/js/front-js/main1.js"></script>
    <script>
        window.onload = function() {
            let customerone = '[[${session.customer}]]';
            if(customerone==="")
                window.location.href="http://localhost:8001/index/cuslogin";
            else {
                $.ajax({
                    type: "get",
                    url: 'http://localhost:8001/order/get',
                    data: {
                        "id": '[[${session.customer.id}]]',
                        "name": '[[${session.customer.name}]]',
                        "password": '[[${session.customer.password}]]',
                        "address": '[[${session.customer.address}]]',
                        "shoppingCart": '[[${session.customer.shoppingCart}]]',
                        "status": '[[${session.customer.status}]]',
                        "token": '[[${session.customer.token}]]',
                        "phone": '[[${session.customer.phone}]]',
                        "mail": '[[${session.customer.mail}]]',
                    },
                    dataType: 'json',
                    success: function (data) {
                        console.log(typeof (data))
                        var maintest = document.getElementById('car');
                        console.log(data);
                        var number = 0;
                        for (var a = 0; a < data.length; a++) {
                            console.log(data.length);
                            number++;
                            var oDiv = document.createElement('div');
                            oDiv.id = "order" + a;
                            oDiv.className = "row hid";
                            oDiv.innerHTML += "<div class=\"check left\"> <i class=\"i_check\" id=\"i_check" + a + "\" οnclick=\"i_check()\" >√</i></div>";
                            oDiv.innerHTML += "<div class=\"img left\"><img src=\"../../static/img/front-images/logo.png\" width=\"80\" height=\"80\"></div>";
                            oDiv.innerHTML += "<div class=\"name left\"><span>" + data[a].products.name + "</span></div>";
                            oDiv.innerHTML += "<div class=\"price left\"><span> " + data[a].products.price + "元</span></div>";
                            oDiv.innerHTML += "<div class=\"item_count_i\"><div class=\"num_count\"><div class=\"count_d\">-</div><div class=\"c_num\">1</div><div class=\"count_i\">+</div></div> </div>";
                            oDiv.innerHTML += "<div class=\"subtotal left\"><span> " + data[a].products.price + " 元</span></div>";
                            oDiv.innerHTML += "<div class=\"ctrl left\"><a href=\"javascript:;\">×</a></div>";
                            maintest.appendChild(oDiv);
                        var flag = true;
                        var check = oDiv.firstChild.getElementsByTagName("i")[0];
                        check.index=a;
                        (function (n) {
                            var ch=document.getElementById('i_check'+n);
                            ch.onclick = function() {
                                // console.log(check.className);
                                if (ch.className === "i_check i_acity") {
                                    ch.classList.remove("i_acity");

                                } else {
                                    ch.classList.add("i_acity");
                                }
                                getAmount();
                            }
                        })(a);
                        oDiv.index=a;
                            var delBtn = oDiv.lastChild.getElementsByTagName("a")[0];
                            (function (n){
                                delBtn.onclick = function() {
                                    var result = confirm("确定删除吗?");
                                    if (result) {
                                        var od=document.getElementById('order'+n);
                                        maintest.removeChild(od);
                                        number--;
                                        getAmount();
                                    }
                                }
                            })(a);
                            var i_btn = document.getElementsByClassName("count_i");
                            for (var k = 0; k < i_btn.length; k++) {
                                i_btn[k].onclick = function() {
                                    bt = this;
                                    //获取小计节点
                                    at = this.parentElement.parentElement.nextElementSibling;
                                    //获取单价节点
                                    pt = this.parentElement.parentElement.previousElementSibling;
                                    //获取数量值
                                    node = bt.parentNode.childNodes[1];
                                    console.log(node);
                                    num = node.innerText;
                                    num = parseInt(num);
                                    num++;
                                    node.innerText = num;
                                    //获取单价
                                    price = pt.innerText;
                                    price = price.substring(0, price.length - 1);
                                    //计算小计值
                                    at.innerText = price * num + "元";
                                    //计算总计值
                                    getAmount();
                                }
                            }
                            //获取所有的数量减号按钮
                            var d_btn = document.getElementsByClassName("count_d");
                            for (k = 0; k < i_btn.length; k++) {
                                d_btn[k].onclick = function() {
                                    bt = this;
                                    //获取小计节点
                                    at = this.parentElement.parentElement.nextElementSibling;
                                    //获取单价节点
                                    pt = this.parentElement.parentElement.previousElementSibling;
                                    //获取c_num节点
                                    node = bt.parentNode.childNodes[1];
                                    num = node.innerText;
                                    num = parseInt(num);
                                    if (num > 1) {
                                        num--;
                                    }
                                    node.innerText = num;
                                    //获取单价
                                    price = pt.innerText;
                                    price = price.substring(0, price.length - 1);
                                    //计算小计值
                                    at.innerText = price * num + "元";
                                    //计算总计值
                                    getAmount();
                                }
                            }
                            (function (n){
                                delBtn.onclick = function() {
                                    var result = confirm("确定删除吗?");
                                    if (result) {
                                        var od=document.getElementById('order'+n);
                                        maintest.removeChild(od);
                                        number--;
                                        getAmount();
                                        $.ajax({
                                            type: "get",
                                            url: 'http://localhost:8001/order/get',
                                            data: {"id":n},
                                            dataType: 'json',
                                            success: function (data) {
                                            },
                                            error() {
                                            }
                                        })
                                    }
                                }
                            })(a);
                        }
                    }
                })
            }
        }
        var index = false;
        function checkAll() {
            var choose = document.getElementById("car").getElementsByTagName("i");
            // console.log(choose);
            if (choose.length != 1) {
                for (i = 1; i < choose.length; i++) {
                    if (!index) {
                        choose[0].classList.add("i_acity2")
                        choose[i].classList.add("i_acity");
                    } else {
                        choose[i].classList.remove("i_acity");
                        choose[0].classList.remove("i_acity2")
                    }
                }
                index = !index;
            }
            getAmount();
        }
        //进行价格合计
        function getAmount() {
            // console.log(ys);
            ns = document.getElementsByClassName("i_acity");
            console.log(ns);
            sum = 0;
            //选中框
            document.getElementById("price_num").innerText = sum;
            for (y = 0; y < ns.length; y++) {
                //小计
                amount_info = ns[y].parentElement.parentElement.lastElementChild.previousElementSibling;
                num = parseInt(amount_info.innerText);
                sum += num;
                document.getElementById("price_num").innerText = sum;
            }
        }
    </script>
    <script>
        function notpayme(){
            $.ajax({
                type: "get",
                url: 'http://localhost:8001/order/get',
                data: {
                    "id": '[[${session.customer.id}]]',
                    "name": '[[${session.customer.name}]]',
                    "password": '[[${session.customer.password}]]',
                    "address": '[[${session.customer.address}]]',
                    "shoppingCart": '[[${session.customer.shoppingCart}]]',
                    "status": '[[${session.customer.status}]]',
                    "token": '[[${session.customer.token}]]',
                    "phone": '[[${session.customer.phone}]]',
                    "mail": '[[${session.customer.mail}]]',
                },
                dataType: 'json',
                success: function (data) {
                    console.log(typeof (data))
                    var maintest = document.getElementById('car');
                    console.log(data);
                    var number = 0;
                    for (var a = 0; a < data.length; a++) {
                        number++;
                        var oDiv = document.createElement('div');
                        oDiv.id = "order" + a;
                        oDiv.className = "row hid";
                        oDiv.innerHTML += "<div class=\"check left\"> <i class=\"i_check\" id=\"i_check" + a + "\" οnclick=\"i_check()\" >√</i></div>";
                        oDiv.innerHTML += "<div class=\"img left\"><img src=\"../../static/img/front-images/logo.png\" width=\"80\" height=\"80\"></div>";
                        oDiv.innerHTML += "<div class=\"name left\"><span>" + data[a].products.name + "</span></div>";
                        oDiv.innerHTML += "<div class=\"price left\"><span> " + data[a].products.price + "元</span></div>";
                        oDiv.innerHTML += "<div class=\"item_count_i\"><div class=\"num_count\"><div class=\"count_d\">-</div><div class=\"c_num\">1</div><div class=\"count_i\">+</div></div> </div>";
                        oDiv.innerHTML += "<div class=\"subtotal left\"><span> " + data[a].products.price + " 元</span></div>";
                        oDiv.innerHTML += "<div class=\"ctrl left\"><a href=\"javascript:;\">×</a></div>";
                        maintest.appendChild(oDiv);
                        var flag = true;
                        var check = oDiv.firstChild.getElementsByTagName("i")[0];
                        check.index=a;
                        (function (n) {
                            var ch=document.getElementById('i_check'+n);
                            ch.onclick = function() {
                                // console.log(check.className);
                                if (ch.className === "i_check i_acity") {
                                    ch.classList.remove("i_acity");

                                } else {
                                    ch.classList.add("i_acity");
                                }
                                getAmount();
                            }
                        })(a);
                        oDiv.index=a;
                        var delBtn = oDiv.lastChild.getElementsByTagName("a")[0];
                        (function (n){
                            delBtn.onclick = function() {
                                var result = confirm("确定删除吗?");
                                if (result) {
                                    var od=document.getElementById('order'+n);
                                    maintest.removeChild(od);
                                    number--;
                                    getAmount();
                                }
                            }
                        })(a);
                        var i_btn = document.getElementsByClassName("count_i");
                        for (var k = 0; k < i_btn.length; k++) {
                            i_btn[k].onclick = function() {
                                bt = this;
                                //获取小计节点
                                at = this.parentElement.parentElement.nextElementSibling;
                                //获取单价节点
                                pt = this.parentElement.parentElement.previousElementSibling;
                                //获取数量值
                                node = bt.parentNode.childNodes[1];
                                console.log(node);
                                num = node.innerText;
                                num = parseInt(num);
                                num++;
                                node.innerText = num;
                                //获取单价
                                price = pt.innerText;
                                price = price.substring(0, price.length - 1);
                                //计算小计值
                                at.innerText = price * num + "元";
                                //计算总计值
                                getAmount();
                            }
                        }
                        //获取所有的数量减号按钮
                        var d_btn = document.getElementsByClassName("count_d");
                        for (k = 0; k < i_btn.length; k++) {
                            d_btn[k].onclick = function() {
                                bt = this;
                                //获取小计节点
                                at = this.parentElement.parentElement.nextElementSibling;
                                //获取单价节点
                                pt = this.parentElement.parentElement.previousElementSibling;
                                //获取c_num节点
                                node = bt.parentNode.childNodes[1];
                                num = node.innerText;
                                num = parseInt(num);
                                if (num > 1) {
                                    num--;
                                }
                                node.innerText = num;
                                //获取单价
                                price = pt.innerText;
                                price = price.substring(0, price.length - 1);
                                //计算小计值
                                at.innerText = price * num + "元";
                                //计算总计值
                                getAmount();
                            }
                        }
                        (function (n){
                            delBtn.onclick = function() {
                                var result = confirm("确定删除吗?");
                                if (result) {
                                    var od=document.getElementById('order'+n);
                                    maintest.removeChild(od);
                                    number--;
                                    getAmount();
                                    $.ajax({
                                        type: "get",
                                        url: 'http://localhost:8001/order/get',
                                        data: {"id":n},
                                        dataType: 'json',
                                        success: function (data) {
                                        },
                                        error() {
                                        }
                                    })
                                }
                            }
                        })(a);
                    }
                }
            })
        }
    </script>
</head>
<body>

<!--====== PRELOADER PART ENDS ======-->

<!--====== HEADER PART START ======-->

<div class="preloader">
    <div class="loader">
        <div class="ytp-spinner">
            <div class="ytp-spinner-container">
                <div class="ytp-spinner-rotator">
                    <div class="ytp-spinner-left">
                        <div class="ytp-spinner-circle"></div>
                    </div>
                    <div class="ytp-spinner-right">
                        <div class="ytp-spinner-circle"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!--====== PRELOADER PART ENDS ======-->

<!--====== HEADER PART START ======-->

<header class="header-area">
    <div class="header-nav">
        <div class="container custom-container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="navigation">
                        <nav class="navbar navbar-expand-lg navbar-light ">
                            <a class="navbar-brand" href="index.html"><img src="../../static/img/front-images/logo.png" alt=""></a> <!-- logo -->
                            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                                <span class="toggler-icon"></span>
                                <span class="toggler-icon"></span>
                                <span class="toggler-icon"></span>
                            </button> <!-- navbar toggler -->

                            <div class="collapse navbar-collapse sub-menu-bar" id="navbarSupportedContent">
                                <ul class="navbar-nav m-auto">
                                    <li class="nav-item">
                                        <a class="nav-link" href="http://localhost:8001/index/index">首页</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="http://localhost:8001/index/menu">食物</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="http://localhost:8001/index/shopping">订单</a>
                                    </li>
                                </ul>
                            </div> <!-- navbar collapse -->
                            <div class="navbar-btn d-none d-md-flex">
                                <ul>
                                    <li><a href="#"><img class="topiconone" src="../../static/img/front-images/icon/topicon.png"></a></li>
                                    <li><a href="#"><img class="topiconone" src="../../static/img/front-images/icon/topusericon.png"></a></li>
                                </ul>
                                <a class="main-btn" href="http://localhost:8001/index/cuslogin" >登录</a>
                            </div>
                        </nav>
                    </div> <!-- navigation -->
                </div>
            </div>
        </div>
    </div>
</header>
    <!--====== HEADER PART ENDS ======-->

    <!--====== PAGE TITLE PART START ======-->
<div class="shoppingsearch">
    <div class="shoppingsearchdiv">
        <div class="divone">
            <span>我的店铺</span>
        </div>
        <div class="divtow">
            <form >
                <div class="divoneinput">
                    <input type="text" placeholder="菜品编号或是名字">
                </div>
                <div class="divtowbuttom">
                    <button type="button"> 搜索</button>
                </div>
            </form>
        </div>
    </div>
</div>
<div>
    <div>
        <div class="shoppinglist">
            <ul>
                <li class="list_xuanzhongone">全部</li>
                <li class="other_listone" onclick="notpayme()">待付款</li>
                <li class="other_listone" onclick="">已支付</li>
                <li class="other_listone" onclick="">购物车</li>
                <li class="other_listone" onclick="">待评价</li>
            </ul>
        </div>
    </div>
</div>
<div class="shoppingdiv">
    <div id="car" class="car">
        <div class="head_row hid">
            <div class="check left"> <i onclick="checkAll()">√</i></div>
            <div class="img left">&nbsp;&nbsp;全选</div>
            <div class="name left">商品名称</div>
            <div class="price left">单价</div>
            <div class="number left">数量</div>
            <div class="subtotal left">小计</div>
            <div class="ctrl left">操作</div>
        </div>
    </div>
    <div id="sum_area">
        <div id="pay" onclick="abc()">去结算</div>
        <div id="pay_amout">合计：<span id="price_num">0</span>元</div>
    </div>
    </div>
</div>
    
    <!--====== PAGE TITLE PART ENDS ======-->

    <!--====== ABOUT PART START ======-->
<div class="w3-agile-footer">
    <div class="container">
        <div class="footer-grids">
            <div class="col-md-3 footer-grid">
                <div class="footer-grid-heading">
                    <h4>地点</h4>
                </div>
                <div class="footer-grid-info">
                    <p>重庆
                        <span>双福</span>
                    </p>
                    <p class="phone">电话 : +1 123 456 789
                        <span>邮电 : <a href="mailto:example@email.com">mail@</a></span>
                    </p>
                </div>
            </div>
            <div class="col-md-3 footer-grid">
                <div class="footer-grid-heading">
                    <h4>网页链接</h4>
                </div>
                <div class="footer-grid-info">
                    <ul>
                        <li><a href="../../templates/index.html">主页</a></li>
                        <li><a href="../../templates/about.html">关于</a></li>
                        <li><a href="../../templates/menu.html">菜品</a></li>
                        <li><a href="../../templates/contact.html">个人</a></li>
                    </ul>
                </div>
            </div>
            <div class="col-md-3 footer-grid">
                <div class="footer-grid-heading">
                    <h4>Newsletter</h4>
                </div>
                <div class="footer-grid-info">
                    <form action="#" method="post">
                        <input type="email" id="mc4wp_email" name="EMAIL" placeholder="Enter your email here" required="">
                        <input type="submit" value="Subscribe">
                    </form>
                </div>
            </div>
            <div class="clearfix"> </div>
        </div>
    </div>
</div>
</body>

</html>

